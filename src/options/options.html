<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <script type="application/javascript" src="../chrome-polyfill.js"></script>
  <link href="style.css" rel="stylesheet">
</head>

<body>
  <div>
    <a href="https://github.com/gyng/save-in/">GitHub</a>
    &middot;
    <a href="https://github.com/gyng/save-in/blob/master/CHANGELOG.md">Changelog</a>
  </div>

  <form id="options">
    <label class="column">
      <h3 class="help" data-help-for="help-standard-variables">
        üìì Variable list (click to expand)</h3>
      <div class="help-text" id="help-standard-variables">
        <h3>Standard</h3>
        <div class="caption">Usable everywhere*</div>
        <div class="box">
          <table>
            <tr>
              <td>
                <code class="click-to-copy">---</code>
              </td>
              <td></td>
              <td>Creates a separator in the context menu
                <i>*decorative</i>
              </td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:date:</code>
              </td>
              <td>2000-01-01</td>
              <td>Current date</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:isodate:</code>
              </td>
              <td>20170123T123040Z</td>
              <td>Current datetime as a UTC ISO8601 string</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:unixdate:</code>
              </td>
              <td>946684800</td>
              <td>Current datetime as a Unix timestamp</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:year:</code>
              </td>
              <td>2000</td>
              <td>Current year</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:month:</code>
              </td>
              <td>01</td>
              <td>Current month</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:day:</code>
              </td>
              <td>24</td>
              <td>Current day of month</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:hour:</code>
              </td>
              <td>13</td>
              <td>Current hour (24-hour)</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:minute:</code>
              </td>
              <td>46</td>
              <td>Current minute</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:second:</code>
              </td>
              <td>05</td>
              <td>Current second</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:pageurl:</code>
              </td>
              <td>https://xyz.com/abc</td>
              <td>URL of the page</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:sourcedomain:</code>
              </td>
              <td>cdn.xyz.com</td>
              <td>Hostname of the source</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:pagedomain:</code>
              </td>
              <td>xyz.com</td>
              <td>Hostname of the page</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:pagetitle:</code>
              </td>
              <td>My Webpage Title!</td>
              <td>Title of the page</td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:linktext:</code>
              </td>
              <td>Direct link to image</td>
              <td>Text of the link, or
                <code>title</code> attribute of element
                <i>* images and links only</i>
              </td>
            </tr>
          </table>
        </div>

        <h3>Filename-only</h3>
        <div class="caption">Only usable when rewriting filenames</div>
        <div class="box">
          <table>
            <tr>
              <td>
                <code class="click-to-copy">:filename:</code>
              </td>
              <td>my_image.jpg</td>
              <td>Full filename
              </td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:fileext:</code>
              </td>
              <td>jpg</td>
              <td>Naive file extension, if available
              </td>
            </tr>

            <tr>
              <td>
                <code class="click-to-copy">:$1:</code>,
                <code class="click-to-copy">:$2:</code>&hellip;
              </td>
              <td></td>
              <td>Capture group where
                <code>1</code> = the n
                <sup>th</sup> capture group
              </td>
            </tr>

          </table>
        </div>
      </div>
      </div>

      <h3 class="help" data-help-for="help-clause-list">
        üìì Clause list (click to expand)</h3>
      <div class="help-text" id="help-clause-list">
        <h3>Output and others</h3>
        <div class="box">
          <table>
            <tr>
              <td>
                <code class="click-to-copy">into:</code>
              </td>
              <td>
                <code>:pagedomain:/:date:</code>
              </td>
              <td>Routes downloads to, or rewrites download filenames into the given pattern</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">capture:</code>
              </td>
              <td>
                <code>pageurl</code>
              </td>
              <td>optional, selects the matcher for regex capture group variables (
                <code class="click-to-copy">:$1:</code>,
                <code class="click-to-copy">:$2:</code>&hellip;)</td>
            </tr>
          </table>
        </div>

        <h3>Matchers</h3>
        <div class="caption">Matchers take a regular expression pattern</div class="caption">

        <div class="box">
          <table>
            <tr>
              <td>
                <code class="click-to-copy">fileext:</code>
              </td>
              <td>
                <code>jpg</code>
              </td>
              <td>Matches the naive file extension</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">frameurl:</code>
              </td>
              <td>
                <code>http://www.google.com</code>
              </td>
              <td>Matches the URL of the current frame</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">linktext:</code>
              </td>
              <td>
                <code>Click here to download</code>
              </td>
              <td>Matches the link text or element
                <code>title</code> attribute</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">mediatype:</code>
              </td>
              <td>
                <code>image</code>
              </td>
              <td>Matches the media type:
                <code>audio</code>,
                <code>video</code>, or
                <code>image</code>
              </td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">naivefilename:</code>
              </td>
              <td>
                <code>cat.jpg</code>
              </td>
              <td>Matches the naive filename</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">pagetitle:</code>
              </td>
              <td>
                <code>Welcome to my page!</code>
              </td>
              <td>Matches the current page title</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">pageurl:</code>
              </td>
              <td>
                <code>http://www.google.com</code>
              </td>
              <td>Matches the current page URL</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">selectiontext:</code>
              </td>
              <td>
                <code>"X-Cops" is the twelfth</code>
              </td>
              <td>Matches the selection text</td>
            </tr>
            <tr>
              <td>
                <code class="click-to-copy">srcurl:</code>
              </td>
              <td>
                <code>cdn.xyz.com</code>
              </td>
              <td>Matches the source URL for media</td>
            </tr>
          </table>
        </div>


        <h3>File rewrite matchers</h3>
        <table>
          <tr>
            <td>
              <code class="click-to-copy">filename:</code>
            </td>
            <td>
              <code>actual_filename.jpg</code>
            </td>
            <td>Matches the final filename</td>
          </tr>
        </table>
      </div>

      <h2>Downloads</h2>
      <h3>Menu items
        <a href="#" class="help" data-help-for="help-paths">help</a>
      </h3>
      <p>Paths relative to default download directory. One path per line. Multiple variables can be used in a path.</p>
      <div class="help-text" id="help-paths">
        <pre>.
images/dogs
images/cats
---
videos/cats
others/:date:/:pagedomain:/foo
</pre>

        <p>with a default download directory of
          <code>~/downloads</code> will create options to save media to the directories</p>

        <pre>
~/downloads/
~/downloads/images/dogs
~/downloads/images/cats
---
~/downloads/videos/cats
~/others/2000-01-01/github.com/foo
</pre>

        <p>Invalid paths (
          <code>..</code> and
          <code>/</code>) are ignored. Files and directories with leading dots (
          <code>foo/.hidden</code>) are considered invalid by Firefox and Chrome.</p>

        <p>The WebExtensions API does not allow files to be saved outside of the default download directory. If you want to
          save the files outside the default download directory, use a
          <a href="https://en.wikipedia.org/wiki/Symbolic_link" target="_blank">symlink</a> inside the default download directory.
          <a href="https://serverfault.com/questions/7109/how-do-i-create-a-symbolic-link-in-windows" target="_blank">Windows</a>,
          <a href="https://apple.stackexchange.com/questions/115646/how-can-i-create-a-symbolic-link-in-terminal" target="_blank">OS X/Unix</a>
        </p>
      </div>
      <textarea type="textarea" id="paths" rows=10 placeholder="." spellcheck="false"></textarea>

      <h3>Behavior</h3>

      <label>
        <input type="checkbox" id="links" /> Enable saving of links. Prefers sources if available.
      </label>

      <label>
        <input type="checkbox" id="selection" /> Enable saving of selected text with a
        <code>.selection.txt</code> extension
      </label>

      <label>
        <input type="checkbox" id="page" /> Enable saving of the current page
      </label>

      <label>
        <input type="checkbox" id="prompt" /> Open a save file dialog when saving
      </label>

      <label>
        <input type="checkbox" id="promptIfNoExtension" /> Open a save file dialog if filename has no extension
      </label>

      <label>
        <select disabled class="chrome-enabled" id="conflictAction">
          <option value="uniquify">Uniquify</option>
          <option value="overwrite">Overwrite</option>
          <option value="prompt">Prompt</option>
        </select>
        when a duplicate filename is encountered (Chrome only)
      </label>

    </label>

    <label class="column">
      <hr>
      <h2>Dynamic downloads</h2>

      <p>
        Optionally, set up rules to route downloads or rewrite filenames. The first matching rule applies. Separate multiple rules
        with an empty line. Each rule must have an
        <code>into</code> clause, at least one matcher clause, and an optional
        <code>capture</code> clause. Multiple variables can be used in the
        <code>into</code> clause. </p>

      <pre>
(matchername): regex
into: directory pattern</pre>

      <p class="chrome-only">CHROME USERS: Special characters in the filename (eg.
        <code>:</code> or
        <code>/</code>) are pre-replaced with the character
        <code>-</code> by Chrome. Match against
        <code>-</code> instead of these special characters. For example, use
        <code>(.*)-large</code> to match filenames instead of
        <code>(.*):large</code>.
      </p>

      <h3>Route downloads
        <a href="#" class="help" data-help-for="help-routes">help</a>
        <span title="Unstable: expect changes in future version" class="caption warning badge">‚öóÔ∏è Unstable</span>
      </h3>
      <p>Optional. Route matching downloads into directories.
        <div class="help-text" id="help-routes">
          Dynamically route downloads into directories. Filenames will still be rewritten if it matches a filename rewrite rule. The
          <code>capture</code> clause allows the use of regex capture groups.

          <pre>
mediaType: audio
srcurl: cdn.myexampleradio.com
into: music/:date:</pre>

          <p>
            <code>cat-1234.jpg</code> ‚Üí
            <code>cat/</code> and
            <code>dog-2345.jpg</code> ‚Üí
            <code>dog/</code>:
          </p>
          <pre>
naivefilename: (cat|dog).*
capture: naivefilename
into: :$1:</pre>

        </div>
        <textarea type="textarea" id="routeDownloadRules" rows=7 placeholder="Optional" spellcheck="false"></textarea>
    </label>

    <label>
      <input type="checkbox" id="routeFailurePrompt" /> Open a save file dialog on routing failure
    </label>

    <label>
      <input type="checkbox" id="routeExclusive" /> Exclusively use routing rules
      <div class="caption caption-line">This disables the submenu for two-click downloads</div>
    </label>

    <label class="column">
      <h3>Rewrite filenames
        <a href="#" class="help" data-help-for="help-filenames">help</a>
        <span title="Unstable: expect changes in future version" class="caption warning badge">‚öóÔ∏è Unstable</span>
      </h3>

      <p>Optional. Rename filenames.</p>

      <div class="help-text" id="help-filenames">
        <p>
          Match filenames against a
          <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions">regex pattern</a> and rewrite them according to a replacement string. Regex capture groups are supported in the
          replacement pattern, and can be referenced by the variables
          <code>:$1:</code> through
          <code>:$n:</code>.
        </p>

        <p>The following example rewrites the filenames
          <ul>
            <li>
              <code>dog_thumbnail.png</code> to
              <code>dog.png</code>
            </li>
            <li>
              <code>twitter_pic.png:large</code> to
              <code>twitter_pic.png</code> only on
              <code>pbs.twimg.com</code>
            </li>
            <li>
              Everything to
              <code>link text.extension</code> only on
              <code>example.com</code>
            </li>
            <li>
              <code>catpic.jpg</code> to
              <code>2017-01-01_catpic.jpeg</code>
            </li>
            <li>
              <code>b18be819-3fcb-0e4d-b7e3-8ae126e2b37f</code> to
              <code>example.com.txt</code>
            </li>
          </ul>
        </p>
        <div>
          <pre>
(.*)\_thumbnail(\..*)
:$1::$2:

(.*)(:|-)large
:$1:
pbs.twimg.com

.*
:linktext:.:fileext:
example.com

(.*)\.jpg
:date::$1:.jpeg

.{8}-.{4}-.{4}-.{12}
:pageurl:.txt
</pre>

        </div>

        <a href="https://github.com/gyng/save-in/wiki/Filename-rewrite">Short list of useful rules</a>
      </div>
      <textarea type="textarea" id="filenamePatterns" rows=7 placeholder="Optional" spellcheck="false"></textarea>
    </label>

    <hr>

    <h2>Notifications</h2>
    <label>
      <input type="checkbox" id="notifyOnSuccess" /> Show notification on successful download
    </label>

    <label>
      <input type="checkbox" id="notifyOnFailure" /> Show notification on failed download
    </label>

    <label>
      Close notification early after
      <input type="number" id="notifyDuration" min="0" />ms
      <div class="caption caption-line">1s = 1000ms. Will not extend beyond OS/browser notification duration.</div>
    </label>

    <hr />

    <h2>Save as shortcuts</h2>
    <label>
      Save shortcuts as
      <select id="shortcutType">
        <option value="HTML_REDIRECT">HTML redirect</option>
        <option value="MAC">Mac .url</option>
        <option value="WINDOWS">Windows .url</option>
        <option value="FREEDESKTOP">Freedesktop .desktop</option>
      </select>
    </label>

    <label>
      <input type="checkbox" id="shortcutMedia" /> Save media as shortcuts instead
    </label>

    <label>
      <input type="checkbox" id="shortcutLink" /> Save links as shortcuts instead
    </label>

    <label>
      <input type="checkbox" id="shortcutPage" /> Save pages as shortcuts instead
    </label>

    <hr>

    <h2>More options
      <div id="reset" class="button float-right">Restore defaults</div>
    </h2>
    <label>
      Truncate path components to
      <input type="number" id="truncateLength" min="1" /> characters
      <div class="caption caption-line">0 = no truncation</div>
    </label>

    <label>
      <input type="checkbox" id="debug" /> Enable debug logging
    </label>

    <div id="submit" type="submit" class="button puffy save">Save</div>
  </form>

  <script src="options.js"></script>
</body>

</html>